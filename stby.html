<html lang="en">
<head>
  <title>My Crew Schedules</title>
</head>
<body>

<!-- Download Forms -->
<form id="scheduledForm" style="text-align: center;">
    <p>SCHEDULED</p>
    <input name="Holding" type="text" value="AV">
    <input name="CrewMemberUniqueId" id="scheduledCrewId" type="text" value="32385184" placeholder="ID">
    <input name="Year" type="text" value="2025">
    <input name="Month" type="text" value="" placeholder="Month">
    <button type="button" onclick="submitForm('scheduled')">DOWNLOAD SCHEDULED</button>
</form>

<form id="actualForm" style="text-align: center;">
    <p>ACTUAL</p>
    <input name="Holding" type="text" value="AV">
    <input name="CrewMemberUniqueId" id="actualCrewId" type="text" value="" placeholder="ID">
    <input name="Year" type="text" value="2025">
    <input name="Month" type="text" value="" placeholder="Month">
    <button type="button" onclick="submitForm('actual')">DOWNLOAD ACTUAL</button>
</form>

<br>
<input type="text" id="favCktPlayer" list="CktPlayers" style="width: 300px;" onchange="fillCrewMemberIds()">
<button type="button" onclick="clearDropdown()">Clear</button>  
<datalist id="CktPlayers">  
    <option value="ABONDANO COZZARELLI CARLOS ERNESTO 80412229">
</datalist> 

<script>
// SET THESE VARIABLES WITH YOUR TOKENS
const AUTH_TOKEN = 'Bearer YOUR_TOKEN_HERE';
const SUBSCRIPTION_KEY = 'YOUR_SUBSCRIPTION_KEY_HERE';

function clearDropdown() {
    document.getElementById("favCktPlayer").value = "";
}

function fillCrewMemberIds() {
    let input = document.getElementById("favCktPlayer");
    let selectedValue = input.value.trim();
    if (selectedValue.length >= 8) {
        let last8Chars = selectedValue.slice(-8).trim();
        document.getElementById("scheduledCrewId").value = last8Chars;
        document.getElementById("actualCrewId").value = last8Chars;
    }
}

async function submitForm(type) {
    const form = type === 'scheduled' ? document.getElementById('scheduledForm') : document.getElementById('actualForm');
    const url = type === 'scheduled' 
        ? 'https://api-avianca.avianca.com/MycreWFlights/api/MonthlyAssignements/Scheduled/Export'
        : 'https://api-avianca.avianca.com/MycreWFlights/api/MonthlyAssignements/Export';
    
    const holding = form.querySelector('[name="Holding"]').value;
    const crewId = form.querySelector('[name="CrewMemberUniqueId"]').value;
    const year = form.querySelector('[name="Year"]').value;
    const month = form.querySelector('[name="Month"]').value;
    
    const boundary = '----WebKitFormBoundary' + Math.random().toString(36).substring(2);
    const formData = [
        `--${boundary}`, 'Content-Disposition: form-data; name="Holding"', '', holding,
        `--${boundary}`, 'Content-Disposition: form-data; name="CrewMemberUniqueId"', '', crewId,
        `--${boundary}`, 'Content-Disposition: form-data; name="Year"', '', year,
        `--${boundary}`, 'Content-Disposition: form-data; name="Month"', '', month,
        `--${boundary}--`, ''
    ].join('\r\n');
    
    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Authorization': AUTH_TOKEN,
                'Ocp-Apim-Subscription-Key': SUBSCRIPTION_KEY,
                'Content-Type': `multipart/form-data; boundary=${boundary}`
            },
            body: formData
        });

        if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${type}_schedule.pdf`;
            a.click();
            window.URL.revokeObjectURL(url);
        } else {
            alert('Error: ' + response.statusText);
        }
    } catch (error) {
        alert('Error: ' + error.message);
    }
}
</script>

</body>
</html>4